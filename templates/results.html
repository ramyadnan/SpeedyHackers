{% extends "base.html" %}

{% block title %}Life Expectancy Result{% endblock %}

{% block content %}
    <div class="container">
        <h1>Your Life Expectancy Result</h1>
        
        <p>You will live until you're... </p>
            <span id="life-expectancy"></span>
        <p>You fall into the category: <span id="category"></span></p>

        <div id="category-image-container">
            <img id="category-image" src="" alt="Category Image">
        </div>

        <p id="category-description"></p>
    </div>
    <div class="share-container">
        <h3>Share Your Results</h3>
        <div class="sharethis-inline-share-buttons"></div>
    </div>

    <a class="back-button" href="health-input-form.html">Go Back to Form</a>

    <script>
        // Function to get query parameters from the URL
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            let age = parseInt(params.get('age'));
            let gender = params.get('gender');
            let weight = parseInt(params.get('weight'));
            let height = parseInt(params.get('height'));
            let activityLevel = params.get('activityLevel');
            let diet = params.get('diet');
            let calories = parseInt(params.get('calories'));
            let alcohol = params.get('alcohol');
            let smoking = params.get('smoking');
            let sleepHours = parseInt(params.get('sleepHours'));
            let stressLevel = parseInt(params.get('stressLevel'));
            let ageColour = "green";
    
            // Example calculation for life expectancy (simplified)
            let lifeExpectancy = 80; // Start with a base value
            if (age) lifeExpectancy -= age * 0.2;
            if (activityLevel === 'sedentary') lifeExpectancy -= 5;
            if (smoking === 'yes') lifeExpectancy -= 10;
            if (alcohol === 'daily') lifeExpectancy -= 5;
    
            // Determine category based on life expectancy
            let category = "";
            if (lifeExpectancy <= 50) {
                category = "Critical";
                ageColour = "red";
            } else if (lifeExpectancy <= 60) {
                category = "Suboptimal";
                ageColour = "orangered";
            } else if (lifeExpectancy <= 70) {
                category = "Stable";
                ageColour = "orange";
            } else if (lifeExpectancy <= 80) {
                category = "Vibrant";
                ageColour = "yellow";
            } else {
                category = "Timeless";
                ageColour = "green";
            }
    
            // Set the results on the page
            document.getElementById('life-expectancy').textContent = Math.round(lifeExpectancy);
            document.getElementById('category').textContent = category;
            document.getElementById('category').style.color = ageColour;
    
            // Optionally set image or description based on category
            let imgElement = document.getElementById('category-image');
            imgElement.src = 'images/' + category.toLowerCase() + '.png'; 
            document.getElementById('category-description').textContent = getCategoryDescription(category);
        }
    
        // Function to get a description based on the category
        function getCategoryDescription(category) {
            switch (category) {
                case "Critical":
                    return "Your health is at significant risk; lifestyle changes are strongly recommended.";
                case "Suboptimal":
                    return "There is room for improvement in your health. Consider healthier habits.";
                case "Stable":
                    return "Your health is stable. Maintaining your current lifestyle is beneficial.";
                case "Vibrant":
                    return "You have a vibrant health profile. Keep up the great work!";
                case "Timeless":
                    return "You are in excellent health. You may enjoy a long and healthy life!";
                default:
                    return "";
            }
        }
        
        window.onload = function() {
            getQueryParams();
        };

        document.getElementById('capture-button').addEventListener('click', function() {
            const resultElement = document.querySelector('.container');
            
            html2canvas(resultElement).then(canvas => {
                // const imageData = canvas.toBlob("image/png");
                // uploadToImageShack(imageData);
                canvas.toBlob(blob => {
                    uploadToImageShack(blob);
                }, 'image/png');
            });
        });

    </script>
    
</body>
</html>

{% endblock %}