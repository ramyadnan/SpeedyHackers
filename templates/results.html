{% extends "base.html" %}

{% block title %}Results{% endblock %}

{% block content %}
<div class="container">
    <h1>Your Life Expectancy Result</h1>
    <p>Your estimated life expectancy is <span id="life-expectancy"></span> years</p>
    <p>You fall into the category: <span id="category"></span></p>

    <div id="category-image-container">
        <img id="category-image" src="" alt="Category Image">
    </div>
    <div id="category-description"></div>

    <div class="share-container">
        <h3>Share Your Results</h3>
        <a href="#" id="facebook-share" target="_blank" class="share-button facebook">Share on Facebook</a>
        <a href="#" id="twitter-share" target="_blank" class="share-button twitter">Tweet</a>
        <a href="#" id="linkedin-share" target="_blank" class="share-button linkedin">Share on LinkedIn</a>
    </div>

    <a href="dasboard.html">Go Back to Form</a>
</div>

<script>
    // Function to get query parameters from the URL
    function getQueryParams() {
        const params = new URLSearchParams(window.location.search);
        let age = parseInt(params.get('age'));
        let gender = params.get('gender');
        let weight = parseInt(params.get('weight'));
        let height = parseInt(params.get('height'));
        let activityLevel = params.get('activityLevel');
        let diet = params.get('diet');
        let calories = parseInt(params.get('calories'));
        let alcohol = params.get('alcohol');
        let smoking = params.get('smoking');
        let sleepHours = parseInt(params.get('sleepHours'));
        let stressLevel = parseInt(params.get('stressLevel'));

        // Example calculation for life expectancy (simplified)
        let lifeExpectancy = 80; // Start with a base value
        if (age) lifeExpectancy -= age * 0.2;
        if (activityLevel === 'sedentary') lifeExpectancy -= 5;
        if (smoking === 'yes') lifeExpectancy -= 10;
        if (alcohol === 'daily') lifeExpectancy -= 5;

        // Determine category based on life expectancy
        let category = "";
        if (lifeExpectancy <= 50) {
            category = "Critical";
        } else if (lifeExpectancy <= 60) {
            category = "Suboptimal";
        } else if (lifeExpectancy <= 70) {
            category = "Stable";
        } else if (lifeExpectancy <= 80) {
            category = "Vibrant";
        } else {
            category = "Timeless";
        }

        // Set the results on the page
        document.getElementById('life-expectancy').textContent = lifeExpectancy.toFixed(1);
        document.getElementById('category').textContent = category;

        // Optionally set image or description based on category
        let imgElement = document.getElementById('category-image');
        imgElement.src = 'images/' + category.toLowerCase() + '.png';
        document.getElementById('category-description').textContent = getCategoryDescription(category);
    }

    // Function to get a description based on the category
    function getCategoryDescription(category) {
        switch (category) {
            case "Critical":
                return "Your health is at significant risk; lifestyle changes are strongly recommended.";
            case "Suboptimal":
                return "There is room for improvement in your health. Consider healthier habits.";
            case "Stable":
                return "Your health is stable. Maintaining your current lifestyle is beneficial.";
            case "Vibrant":
                return "You have a vibrant health profile. Keep up the great work!";
            case "Timeless":
                return "You are in excellent health. You may enjoy a long and healthy life!";
            default:
                return "";
        }
    }
    // Set up share links for social media
    function setUpShareLinks() {
        const currentUrl = window.location.href;
        const lifeExpectancy = document.getElementById('life-expectancy').textContent;
        const category = document.getElementById('category').textContent;

        const shareText = `My estimated life expectancy is ${lifeExpectancy} years and I fall into the "${category}" category! Find out yours!`;

        // Facebook share link
        document.getElementById('facebook-share').href =
            `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}&quote=${encodeURIComponent(shareText)}`;

        // Twitter share link
        document.getElementById('twitter-share').href =
            `https://twitter.com/intent/tweet?url=${encodeURIComponent(currentUrl)}&text=${encodeURIComponent(shareText)}`;

        // LinkedIn share link
        document.getElementById('linkedin-share').href =
            `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(currentUrl)}`;
    }

    // Call the function after page load to ensure all elements are available
    window.onload = function () {
        getQueryParams(); // Ensure this is called to populate life expectancy and category
        setUpShareLinks();
    };



    // Call the function on page load
    window.onload = getQueryParams;
</script>
{% endblock %}